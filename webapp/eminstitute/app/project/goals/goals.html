<div id="resultsdiv">
#if( $selectedcat && $topgoals)
<h4>$selectedcat goals:</h4>
#elseif( $topgoals)
<h4>[[All Goals]]:</h4>
#end

#if( !$topgoals && $caneditdata)

<div class="clearfix"></div>
 <a class="btn btn-secondary btn-sm emdialog pull-left" 
 	title="[[New Goal]]" 
 	data-width="700"
 	href="$apphome/project/goals/editgoalpanel.html?collectionid=$librarycol.getId()&categoryid=$!selectedcat.getId()" ><i class="fas fa-plus"></i> New Goal</a>

#end


<div class="clearfix"></div>
#set( $col = 0)
#foreach( $row in $topgoals )

#set( $col = $col + 1)

<div class="goals-column-container">
<div class="goals-column">
#if( $selectedcat )
<div class="goals-column-header">

	#if( $col == 1)
	[[High Priority]] 
		#if( $caneditdata)	
		 <a class="btn btn-secondary btn-sm emdialog pull-left" 
		 	title="[[New Goal]]" 
		 	data-width="700"
		 	href="$apphome/project/goals/editgoalpanel.html?collectionid=$librarycol.getId()&categoryid=$!selectedcat.getId()" ><i class="fas fa-plus"></i></a>
		 #end	
	#elseif( $col == 2)
	[[Medium]]
	#else
	[[Lower Priority]]
	#end
</div>
#end

<ul class="projectgoals ui-sortable" data-collectionid="$librarycol.getId()" data-categoryid="$!selectedcat.id" data-savepath="$apphome/project/goals/savecategorysort.html">

#foreach( $goal in $row )  

<li class="card card-mini #if( $caneditdata) ui-draggable ui-draggable-handle #end card-goal" data-goalid="$goal.id">
    	<div class="goal-body">
		    <a href="$apphome/project/goals/editgoal.html?id=${goal.id}&collectionid=$librarycol.getId()&categoryid=$!selectedcat.getId()"
		    	title="[[Full Screen]]" class="editgoalopen" >
	    		<i class="fas fa-expand"></i> 
			</a>
		    <a href="$apphome/project/goals/editgoalpanel.html?id=${goal.id}&collectionid=$librarycol.getId()&categoryid=$!selectedcat.getId()"
		    	title="[[Goal Editor]]" class="emdialog editgoalshow"  data-width="900" >
		    	$goal.name
			</a>
    	</div>
		#set( $tasks = $mediaarchive.getSearcher("goaltask").query().exact("projectgoal", $goal.getId()).not("taskstatus","complete").search() )
		#if ($tasks)
			<div class="goal-footer"> 
			#foreach($task in $tasks)
				<a href="$apphome/project/goals/index.html?collectionid=$librarycol.getId()&nodeID=$task.projectdepartment" class="btn btn-xs taskcomplete$!{task.taskstatus}" title="${task}">$task</a>
			#end
			</div>
		#end
</li>
#end

</ul>

</div>
</div>
#end

<div class="clearfix"></div>

#if( $closedgoals.size() > 0)
<a class="btn" href="$apphome/project/goals/goalclosedsearch.html?collectionid=$librarycol.id">	View Closed Goals ($closedgoals.size()) </a>
#end
#if( $nextpage )

<a class="btn" href="$apphome/project/goals/goals.html?collectionid=$librarycol.id&nodeID=${selectedcat.id}&page=$nextpage"> View more goals ($nextpage) </a>

#end

</div>